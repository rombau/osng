var osApp=angular.module("OnlineSoccer",["ngRoute","ngSanitize","ngCookies","mobile-angular-ui","mobile-angular-ui.gestures"]);osApp.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){e.when("/",{template:"<login-form></login-form>"}).when("/index.html",{template:"<login-form></login-form>"}).when("/index.php",{template:"<login-form></login-form>"}).when("/error",{template:'<div class="scrollable"><div class="scrollable-content"><div class="section"><span ng-bind-html="error"></span></div></div></div>'}).when("/zugabgabe.php",{template:"<move-component></move-component>"}).when("/player/:id",{template:function(e){return'<embedded-site site="../sp.php?s='+e.id+'"></embedded-site>'}}).when("/:site",{template:function(e){return'<embedded-site site="../'+e.site+'"></embedded-site>'}}).otherwise({template:'<div class="scrollable"><div class="scrollable-content"><div class="section">Unbekannte Seite!</div></div></div>'}),n.interceptors.push(["$rootScope","$location",function(e,t){var n=document.querySelector(".app-progress-indicator"),o=0;return{request:function(e){return 0===o&&angular.element(n).addClass("loading"),o++,e},requestError:function(e){return e},response:function(e){return o--,0===o&&angular.element(n).removeClass("loading"),e},responseError:function(r){return o--,angular.element(n).removeClass("loading"),e.error=""+r,t.path("error"),r}}}])}]),osApp.filter("trustAsResourceUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),osApp.factory("Popup",["SharedState",function(e){var t=null;return{open:function(n,o){n&&(o?e.setOne(n,o):e.turnOn(n),t=n)},hide:function(){return!!t&&(e.turnOff(t),t=null,!0)},sidebar:function(e){e&&(t=e)}}}]),osApp.run(["$rootScope","Popup",function(e,t){e.$on("$locationChangeStart",function(n,o,r){!e.error&&t.hide()&&n.preventDefault()}),e.$on("mobile-angular-ui.state.changed.leftSwipe",function(e,n,o){n&&t.sidebar("leftSwipe")})}]),osApp.factory("Player",[function(){function e(){this.id=0,this.name="",this.pos="",this.alter=0,this.geburtstag=0,this.land="",this.flagge="",this.moral=0,this.fitness=0,this.skills=[],this.skill=0,this.opti=0,this.sonder="",this.gehalt=0,this.marktwert=0,this.vertrag=0}return e.Positions=["TOR","ABW","DMI","MIT","OMI","STU"],e.Skill=["SCH","BAK","KOB","ZWK","DEC","GES","FUQ","ERF","AGG","PAS","AUS","UEB","WID","SEL","DIS","ZUV","EIN"],e.prototype={getShortName:function(){var e=this.name.indexOf(" ");return e!==-1?this.name.substr(e):this.name}},e}]),osApp.factory("Move",["Player",function(e){function t(){this.valid=!1,this.players=[],this.information={},this.information.zat=0,this.information.date=new Date,this.information.type="",this.information.home=!1,this.information.against={},this.information.against.id=0,this.information.against.name="",this.zats=[],this.options=[],this.Option=function(){this.page=0,this.item=0,this.text=""},this.adjustments=[],this.Adjustment=function(){this.option=new Option,this.id=0,this.text="",this.params={zao_einspieler:{},zao_spieler:{},zao_minute:{},zao_abhaengigkeit:{},P1:{},P2:{},P3:{},spieler_id:{}}}}return t.GRID_ROWS=15,t.GRID_COLUMNS=11,t.SET_PLAYER_INDICATOR=" ◉",t.SUBSTITUTE_INDICATOR=" ⇄",t.prototype={sortPlayers:function(){return this.players.length>0&&this.players.sort(function(t,n){var o=e.Positions.indexOf(n.pos)-e.Positions.indexOf(t.pos);return 0===o?n.opti-t.opti:o}),this.players},getStartPlayersAverage:function(e){for(var t=0,n=0,o=0;o<this.players.length;o++){var r=this.players[o];null!==r.row&&null!==r.col&&void 0!==r.row&&void 0!==r.col&&r.row>=0&&r[e]&&(t+=r[e],n++)}var a=Math.round(t/11*100)/100;return isNaN(a)?0:a},generateAdjustmentText:function(e){var t,n,o="",r=e.params.zao_abhaengigkeit.text;switch(r&&(n="in der "+e.params.zao_minute.text+". Minute","Immer durchführen"===r?r="Immer":-1!==(t=r.search(/ in/))?r=r.substring(0,t):-1!==(t=r.search(/ ab/))&&(r=r.substring(0,t),n="ab der "+e.params.zao_minute.text+". Minute")),e.option.item){case 1:o+=r,o+=" : ",o+=e.option.text,o+=" von ",o+=e.params.zao_einspieler.text,o+=" für ",o+=e.params.zao_spieler.text,o+=" ",o+=n,o+=" ",o+=e.params.P3.text||"auf Position "+e.params.P1.text+e.params.P2.text;break;case 5:o+=r,o+=" : ",o+=e.option.text,o+=" von ",o+=e.params.zao_spieler.text,o+=" auf Position ",o+=e.params.P1.text+e.params.P2.text,o+=" ",o+=n;break;case 6:o+=r,o+=" : ",o+="Positionsbezogen"===e.params.P1.text?"Positionsbezogene Manndeckung":"Manndeckung aufheben"===e.params.P1.text?"Manndeckung aufheben":"Manndeckung von "+e.params.P1.text,o+=" durch ",o+=e.params.zao_spieler.text,o+=" ",o+=n;break;case 2:case 3:case 4:o+=r,o+=" : ",o+=e.option.text,o+=" einstellen auf ",o+=e.params.P1.text,o+=" ",o+=n;break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:o=e.option.text+" : "+e.params.spieler_id.text;break;case 16:case 17:case 18:o+=r,o+=" : ",o+=n,o+=" ",o+=e.option.text.replace("Taktik","- Grundtaktik"),o+=" : ",o+=e.params.P1.text}return o}},t}]),osApp.factory("Account",["$http","$q","HtmlTransformationUtil",function(e,t,n){var o=function(){this.id=0,this.name="Demoteam",this.image="00000000.png"},r={loggedIn:!1,currentTeam:0,teams:[new o],loadTeamData:function(t){return e({url:"../haupt.php"+(t?"?changetosecond=true":""),method:"GET",transformResponse:function(e){var t,r,a=n.getEnsuredDocument(e),i=a.getElementsByTagName("img"),s=a.getElementsByTagName("b"),l=i[i.length-1],u=new o;t=/images\/wappen\/((\d+)\.(png|gif))/gm,r=t.exec(l.src||l.outerHTML),r&&(u.id=+r[2],u.image=r[1]);for(var m=0;m<s.length;m++)s[m].textContent.search(/Willkommen im Managerb/)!==-1&&(u.name=s[m].textContent.split(" von ")[1]);return u}})},login:function(t,o){return e({url:"../validate.php",method:"POST",data:{action:"os_login",sdauer:0,loginemail:t,passwort:o},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+(null===e[n]?"":encodeURIComponent(e[n])));return t.join("&")},transformResponse:function(e){var t=n.getEnsuredDocument(e),o=t.getElementsByTagName("p");if(o&&o.length&&o.length>0)throw o[o.length-1].textContent;return!0}})},initialize:function(){return t(function(e,t){r.loadTeamData(2).then(function(t){var n=t.data;r.loadTeamData(1).then(function(t){angular.copy([t.data],r.teams),r.teams[0].id!==n.id&&(r.currentTeam>0?r.teams.splice(0,0,n):r.teams.push(n)),e()})})})},getCurrentTeam:function(){return r.teams[r.currentTeam]},getOtherTeam:function(){for(var e=0;e<r.teams.length;e++)if(e!==r.currentTeam)return r.teams[e];return null},toggleCurrentTeam:function(){r.teams.length>1&&(r.currentTeam=0===r.currentTeam?1:0)}};return r.initialize(),r}]),osApp.factory("HtmlTransformationUtil",[function(){return{extractIdFromHref:function(e){if(e){if(e.search(/javascript:.+(\d+)/)!==-1)return+e.split("(")[1].split(")")[0];if(e.search(/sp\.php.+s=(\d+)/)!==-1)return+e.split("s=")[1].split("&")[0];if(e.search(/st\.php.+c=(\d+)/)!==-1)return+e.split("c=")[1].split("&")[0]}return null},getEnsuredDocument:function(e){var t,n;if(t=/F.+r die Dauer von ZAT (\d+) sind die Seiten von OS 2\.0 gesperrt!/gm,n=t.exec(e))throw n[0];if(t=/Diese Seite ist ohne Team nicht verf.+gbar!/gm,n=t.exec(e))throw n[0];return(new DOMParser).parseFromString(e,"text/html")}}}]),osApp.component("embeddedSite",{templateUrl:"components/embedded/embedded.html",controller:["$sce",function(e){var t=document.querySelector(".app-progress-indicator");angular.element(t).addClass("loading"),window.embeddedLoaded=function(){angular.element(t).removeClass("loading")},e.trustAsResourceUrl(this.site)}],bindings:{site:"@"}}),osApp.factory("PlayerTransformation",["Player","HtmlTransformationUtil",function(e,t){var n={transformPlayer:function(n){var o=new e,r=t.getEnsuredDocument(n),a=r.getElementsByTagName("table");return o.name=a[0].rows[0].cells[2].textContent,o.alter=+a[0].rows[0].cells[5].textContent,o.gehalt=+a[0].rows[0].cells[8].textContent.match(/([\d|\.]+) EUR/)[1].replace(/\./g,""),o.land=a[0].rows[1].cells[1].textContent,o.flagge=a[0].rows[1].cells[1].firstChild.src,o.geburtstag=+a[0].rows[1].cells[4].textContent.substring(4),o.vertrag=+a[0].rows[1].cells[7].textContent,o.marktwert=+a[0].rows[2].cells[1].textContent.match(/([\d|\.]+) EUR/)[1].replace(/\./g,""),o.pos=a[0].rows[1].cells[4].textContent,o}};return n}]),osApp.factory("PlayerWebClient",["$http","Player","PlayerTransformation",function(e,t,n){return{loadPlayer:function(t){return e({url:"../sp.php?s="+t,method:"GET",transformResponse:n.transformPlayer})}}}]),osApp.component("player",{templateUrl:"components/player/player.html",bindings:{player:"<object"},controller:["PlayerWebClient",function(e){var t=this;e.loadPlayer(t.player.id).then(function(e){t.player=e.data})}]}),osApp.component("playerLink",{templateUrl:"components/player/player.link.html",bindings:{player:"<object"},controller:["Popup",function(e){var t=this;t.openPopup=function(){e.open("modalPlayer",t.player)}}]}),osApp.component("loginForm",{templateUrl:"components/login/login.html",controller:["$location","Account",function(e,t){var n=this;n.account=t,n.login=function(){n.account.login(n.account.email,n.account.password).then(function(t){t.data&&(n.account.loggedIn=!0,n.account.initialize().then(function(){e.path("/haupt.php")}))})}}]});var MenuItem=function(e,t,n){this.id=e.replace(/\W/g,""),this.label=e,this.path=t,this.external=n||!1,this.items=[],this.addMenuItem=function(e){this.items.push(e)}};osApp.component("mainMenu",{templateUrl:"components/menu/menu.html",controller:["$http","$location","$route","Account","SharedState",function(e,t,n,o,r){var a=this;a.menuItems=[],a.account=o,e({url:"../os_menu_haupt.html",method:"GET",transformResponse:function(e){for(var t,n=/m\((\d+)(?:,"([^"]+)")?(?:,"([^"]+)")?(?:,"([^"]+)")?.*\)/gm,o=[],r=n.exec(e);r;){var a=r[2].replace(/\s*\/\s*/," / "),i=(!r[4]||"os_main"!==r[4])&&"index.php"!==r[3],s=r[3]?i?r[3]:"#/"+r[3]:void 0;1===+r[1]?(t=new MenuItem(a,s,i),o.push(t)):t.addMenuItem(new MenuItem(a,s,i)),r=n.exec(e)}return o}}).then(function(e){a.menuItems=e.data},function(e){}),a.handleItemClick=function(e){e.items.length>0?(r.get("submenu")===e.id&&r.isActive(e.id)?r.turnOff(e.id):r.turnOn(e.id),r.set("submenu",e.id)):r.turnOff("uiSidebarLeft")},a.getIconClass=function(e){return e.items.length>0?r.get("submenu")===e.id&&r.isActive(e.id)?"fa-chevron-circle-down":"fa-chevron-circle-right":"fa-caret-square-o-right"},a.changeToOtherTeam=function(){o.loadTeamData(!0).then(function(){o.toggleCurrentTeam(),"/haupt.php"!==t.path()?t.path("/haupt.php"):n.reload()})}}]}),osApp.factory("MoveTransformation",["Move","Player","HtmlTransformationUtil",function(e,t,n){var o={transformSetup:function(o){var r=new e,a=n.getEnsuredDocument(o),i=a.getElementsByTagName("table"),s=i[1].rows[0].cells[0],l=i[1].rows[0].cells[1],u=i[1].rows[0].cells[2],m=i[3],c=i[4],p=/ZA f.+r ZAT (\d+) Termin: \w+, ([A-z]+ )*(\d+)\.[ ]*([\w|ä]+)[\.| ]*(\d\d\d\d) ([A-z]+ )*(\d+):(\d+):*(\d+)*/gm,f=p.exec(s.textContent);if(f){r.information.zat=+f[1];var d=f[3],h=+f[4]-1||["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].indexOf(f[4]),g=f[5],v=f[7],y=f[8],w=f[9]||0;r.information.date=new Date(g,h,d,v,y,w)}p=/(\w+) ([\w|ä]+) : <a href="javascript:teaminfo\((\d+)\)">(.*)<\/a>/gm,f=p.exec(l.innerHTML),f&&(r.information.type=f[1],r.information.home="Heim"===f[2],r.information.against={},r.information.against.id=+f[3],r.information.against.name=f[4]),r.valid=/Zugabgabe: G.+ltig/.test(u.textContent);var b,T,x,S=[];for(T=1;T<=e.GRID_ROWS;T++)for(b=m.rows[T],x=1;x<=e.GRID_COLUMNS;x++)S.push(b.cells[x].textContent);for(T=1;T<c.rows.length;T++)if(b=c.rows[T],9===b.cells.length){var A=new t;A.id=n.extractIdFromHref(b.cells[1].firstChild.href),A.name=b.cells[1].textContent,A.pos=b.cells[1].className,A.alter=+b.cells[2].textContent,A.moral=+b.cells[4].textContent,A.fitness=+b.cells[5].textContent,A.skill=+b.cells[6].textContent,A.opti=+b.cells[7].textContent,A.sonder=b.cells[8].textContent,A.col=null,A.row=null;var C=b.cells[0].firstChild.value;if("T"===C)A.col=0,A.row=0;else{var P=["V","W","X","Y","Z","U"].indexOf(C);if(P>=0)A.col=-P,A.row=-1;else{var I=S.indexOf(C);C&&I>=0&&(A.col=I%11+1,A.row=Math.floor(I/11)+1)}}r.players.push(A)}for(var E=a.getElementsByName("lauf")[0],R=0;R<E.options.length;R++){var O={};O.value=+E.options[R].value,O.label=E.options[R].text,O.value>0&&r.zats.push(O)}return r},transformActions:function(e){return o._transformOptions(e,1)},transformOptions:function(e){return o._transformOptions(e,2)},_transformOptions:function(t,o){for(var r,a=new e,i=n.getEnsuredDocument(t),s={},l=i.getElementsByTagName("select")[0],u=0;u<l.options.length;u++){var m=new a.Option;m.page=o,m.item=+l.options[u].value,m.text=l.options[u].text,m.item>0&&(a.options.push(m),r=m.text.split(" festlegen")[0].replace("schütze","").replace("Taktik","Grundtaktik"),s[r]=m)}for(var c=i.getElementsByTagName("table")[3],p=0;p<c.rows.length-1;p++){var f=c.rows[p],d=new a.Adjustment;d.id=+f.cells[0].firstChild.value,d.text=f.cells[1].textContent.replace(/ *: /g," : ");for(r in s)s.hasOwnProperty(r)&&d.text.search(r)!==-1&&(d.option=s[r]);a.adjustments.push(d)}return a},transformAdjustmentForm:function(t){for(var o={method:"GET",lines:[]},r=n.getEnsuredDocument(t),a=r.getElementsByTagName("table")[3],i=0;i<a.rows.length-1;i++){for(var s=a.rows[i],l=s.cells[0].getElementsByTagName("select").length>0,u={label:l?"":s.cells[0].textContent,combos:[]},m=s.cells[l?0:1].getElementsByTagName("select"),c=12,p=0;p<m.length;p++){for(var f=m[p],d={name:f.name,options:[]},h=0,g=0;g<f.options.length;g++){var v=f.options[g];h=Math.max(h,v.textContent.length),d.options.push({label:v.textContent.replace(/ \([A-T]\)/,e.SET_PLAYER_INDICATOR).replace(/ \([U-Z]\)/,e.SUBSTITUTE_INDICATOR),value:v.value})}d.width=h>2?h>5?c:3:2,d.value=f.value||d.options[0].value,u.combos.push(d),c-=d.width}o.lines.push(u)}return o},transformPlayers:function(e){var t,n=[],o=[];for(t=0;t<e.length;t++){var r=e[t];null!==r.row&&null!==r.col&&void 0!==r.row&&void 0!==r.col&&(n.push(["player_"+r.id,r.col,r.row]),r.row===-1&&(o[-r.col]=r))}if(n.length<17)for(t=0;t<6;t++)o[t]||n.push(["player_0",-t,-1]);return"aufstellung="+JSON.stringify(n)}};return o}]),osApp.factory("MoveWebClient",["$q","$http","Move","MoveTransformation",function(e,t,n,o){return{loadMove:function(n){var r;return t({url:"../zugabgabe.php"+(n?"?lauf="+n:""),method:"GET",transformResponse:o.transformSetup}).then(function(n){r=n.data;var a=e.defer(),i=[];return i.push(t({url:"../zugabgabe.php?p=1",method:"GET",transformResponse:o.transformActions})),i.push(t({url:"../zugabgabe.php?p=2",method:"GET",transformResponse:o.transformOptions})),e.all(i).then(function(e){r.options=e[0].data.options.concat(e[1].data.options),r.adjustments=e[0].data.adjustments.concat(e[1].data.adjustments),a.resolve(r)},a.reject,a.notify),a.promise})},saveMove:function(n){return t({url:"../zugabgabe_beta.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:n.players,transformRequest:o.transformPlayers}).then(function(o){var r=e.defer();if("Count mismatch"===o.data)return r.reject(o.data),r.promise;for(var a=[],i=0;i<n.adjustments.length;i++){var s=n.adjustments[i];if(!s.id||s.markDeleted){var l;if(s.markDeleted)l={p:s.option.page,delzae:s.id,delete:"++++Gewählte+Aktion+löschen+++"};else{l={p:s.option.page,itemcreate:s.option.item,anlegen:"+++Neue+Aktion+anlegen+++"};for(var u in s.params)s.params.hasOwnProperty(u)&&(l[u]=s.params[u].value)}a.push(t({url:"../zugabgabe.php",params:l,method:"GET"}))}}return e.all(a).then(function(e){t({url:"../checkza.php",method:"GET"}).then(r.resolve,r.reject,r.notify)},r.reject,r.notify),r.promise})},loadAdjustmentForm:function(e){return t({url:"../zugabgabe.php?p="+e.page+"&item="+e.item,method:"GET",transformResponse:o.transformAdjustmentForm})}}}]),osApp.component("moveComponent",{templateUrl:"components/move/move.html",controller:["$location","$window","SharedState","Popup","MoveWebClient","Move",function(e,t,n,o,r,a){var i=this;i.move=new a,i.adjustmentForm={};var s=6;i.grid=function(){for(var e=new Array(a.GRID_ROWS),t=0;t<a.GRID_ROWS;t++)e[t]=new Array(a.GRID_COLUMNS);return e}(),i.isPlayerSet=function(e){if(e)return null!==e.row&&null!==e.col&&void 0!==e.row&&void 0!==e.col;for(var t=0;t<i.move.players.length;t++)if(i.isPlayerSet(i.move.players[t]))return!0;return!1},i.grid.setPlayer=function(e,t,o){var r=null;return r=o>0?i.grid[o-1][t-1]:0===t&&0===o?i.getKeeper():i.getSubst()[-t],2===n.get("activeTab")?(o>0?e.row===-1?i.addAdjustment(i.move.options[0],function(n){i.adjustmentForm.lines[0].combos[0].value=""+e.id,r?(n.lines[1].combos[0].value=""+r.id,n.lines[4].combos[2].value="K"):(n.lines[4].combos[0].value=String.fromCharCode(65+(a.GRID_ROWS-o)),n.lines[4].combos[1].value=""+t)}):r||i.addAdjustment(i.move.options[4],function(n){n.lines[0].combos[0].value=""+e.id,n.lines[1].combos[0].value=String.fromCharCode(65+(a.GRID_ROWS-o)),n.lines[1].combos[1].value=""+t}):0===t&&0===o?e.row===-1&&i.addAdjustment(i.move.options[0],function(t){t.lines[0].combos[0].value=""+e.id,r&&(t.lines[1].combos[0].value=""+r.id),t.lines[4].combos[2].value="T"}):e.row!==-1&&i.addAdjustment(i.move.options[0],function(t){t.lines[1].combos[0].value=""+e.id,r&&(t.lines[0].combos[0].value=""+r.id),t.lines[4].combos[2].value="K"}),!0):(o>0&&(i.grid[o-1][t-1]=e),i.isPlayerSet(e)&&e.row>0&&(i.grid[e.row-1][e.col-1]=r),r&&(r.row=e.row,r.col=e.col),e.row=o,e.col=t,r)},i.grid.removePlayer=function(e){return 2===n.get("activeTab")||(i.isPlayerSet(e)&&e.row>0&&(i.grid[e.row-1][e.col-1]=null),e.row=null,e.col=null,!1)},i.getKeeper=function(){for(var e=0;e<i.move.players.length;e++){var t=i.move.players[e];if(0===t.row&&0===t.col)return t}return null},i.getSubst=function(){for(var e=new Array(s),t=0;t<i.move.players.length;t++){var n=i.move.players[t];n.row===-1&&(e[-n.col]=n)}return e},i.getAdjustments=function(){for(var e=[],t=0;t<i.move.adjustments.length;t++){var n=i.move.adjustments[t];!n.id&&n.markDeleted||e.push(n)}return e.length>0&&e.sort(function(e,t){return e.option.item-t.option.item}),e},i.addAdjustment=function(e,t){r.loadAdjustmentForm(e).then(function(n){if(n.data&&n.data.lines){i.option=e,i.adjustmentForm=n.data;var r=[];r[a.SET_PLAYER_INDICATOR]=[],r[a.SUBSTITUTE_INDICATOR]=[];for(var s=0;s<i.move.players.length;s++){var l=i.move.players[s];l.row===-1?r[a.SUBSTITUTE_INDICATOR].push(l.name):i.isPlayerSet(l)&&r[a.SET_PLAYER_INDICATOR].push(l.name)}for(var u=0;u<i.adjustmentForm.lines.length;u++)for(var m=i.adjustmentForm.lines[u],c=0;c<m.combos.length;c++)for(var p=m.combos[c],f=0;f<p.options.length;f++){var d=p.options[f];r[a.SET_PLAYER_INDICATOR].indexOf(d.label)>=0?d.label+=a.SET_PLAYER_INDICATOR:r[a.SUBSTITUTE_INDICATOR].indexOf(d.label)>=0&&(d.label+=a.SUBSTITUTE_INDICATOR)}t&&t(i.adjustmentForm),o.open("moveAction")}})},i.removeAdjustment=function(e){e.markDeleted=!e.markDeleted},i.saveAdjustment=function(){var e=new a,t=new e.Adjustment;t.option.item=i.option.item,t.option.page=i.option.page,t.option.text=i.option.text;for(var n=0;n<i.adjustmentForm.lines.length;n++)for(var o=i.adjustmentForm.lines[n],r=0;r<o.combos.length;r++){for(var s,l=o.combos[r],u=0;u<l.options.length;u++){var m=l.options[u];if(m.value===l.value){s=m.label.replace(a.SET_PLAYER_INDICATOR,"").replace(a.SUBSTITUTE_INDICATOR,"");break}}t.params[l.name]={value:l.value,text:s}}t.text=e.generateAdjustmentText(t),i.move.adjustments.push(t)};var l=function(e){i.move=e,i.move.players=e.sortPlayers();for(var t=0;t<i.move.players.length;t++){var n=i.move.players[t];n.row>0&&n.col>0&&(i.grid[n.row-1][n.col-1]=n)}};i.save=function(){for(var e=0,n=0;n<i.move.players.length;n++){var a=i.move.players[n];i.isPlayerSet(a)&&a.row>=0&&e++}e<11?t.alert("Es ist (vorläufig) nicht möglich die Zugabgabe zu speichern, solange nicht 11 Spieler aufgestellt sind!"):r.saveMove(i.move).then(function(){r.loadMove().then(l),o.open("moveCheck")})},i.load=function(e){return e?(r.loadMove(i.zat).then(l),void(i.zat=null)):(i.zat=i.move.zats[0].value,void o.open("moveLoad"))},r.loadMove().then(l)}]}),osApp.component("movePlayer",{templateUrl:"components/move/move.player.html",bindings:{player:"<object",onMove:"&",onRemove:"&"},controller:["$scope","$element","$document","$drag","$touch","$transform","$timeout","$interval","SharedState",function(e,t,n,o,r,a,i,s,l){var u=this,m=[];m.push(document.querySelector(".grid-container")),m.push(document.querySelector(".keeper-container")),m.push(document.querySelector(".subst-container"));var c=t[0].firstChild,p=c.getBoundingClientRect(),f=function(){if(null===u.player.row&&null===u.player.col){var e=document.querySelector(".selection-container");if(e)return function(t){t?(angular.element(e).addClass("moving"),angular.element(c).addClass("moving")):(angular.element(e).removeClass("moving"),angular.element(c).removeClass("moving"))}}return function(e){e?(angular.element(c).addClass("moving"),angular.element(c.nextElementSibling).addClass("moving")):(angular.element(c).removeClass("moving"),angular.element(c.nextElementSibling).removeClass("moving"))}}(),d={navbar:51,area:document.querySelector(".scroll-area"),height:document.querySelector(".scroll-area").scrollHeight,slow:{margin:25,offset:5},fast:{margin:12,offset:10},interval:300,offset:0,promise:null},h=!1,g={transform:function(e,t,n){d.promise&&(s.cancel(d.promise),d.promise=null);var o=function(){for(var e=0;e<m.length;e++)if(m[e]){var o=m[e].getBoundingClientRect();if(n.x>o.left&&n.x<o.right&&n.y>o.top&&n.y<o.bottom){var r=n.x-o.left,a=n.y-o.top;return t.translateX=o.left+(r-r%p.width)-p.left,t.translateY=o.top+(a-a%p.height)-p.top,null!==u.player.row&&null!==u.player.col&&(t.translateY+=d.offset),t}}return t.translateX=n.distanceX,t.translateY=n.distanceY,null!==u.player.row&&null!==u.player.col&&(t.translateY+=d.offset),t},r=function(){var e=0;return window.innerHeight>2*d.slow.margin&&(n.y<d.navbar+d.slow.margin&&d.area.scrollTop>=d.slow.offset?e=n.y<d.navbar+d.fast.margin&&d.area.scrollTop>=d.fast.offset?-d.fast.offset:-d.slow.offset:n.y>window.innerHeight-d.slow.margin&&(e=n.y>window.innerHeight-d.fast.margin?d.fast.offset:d.slow.offset,d.area.scrollTop+e>d.height-d.area.clientHeight&&(e=d.height-d.area.clientHeight-d.area.scrollTop))),e},i=function(){var t=r();d.offset+=t,d.area.scrollTop+=t;var n=o();return a.set(e,n),n};return 0!==r()?(d.promise=s(i,d.interval),i()):o()},start:function(e,t){h=!0,f(!0),l.turnOff("leftSwipe"),d.offset=0},move:function(e,t){},cancel:function(e,t){f(!1),h=!1,s.cancel(d.promise),d.promise=null},end:function(t,n){for(var o=!1,r=0;r<m.length;r++)if(m[r]){var a=m[r].getBoundingClientRect();if(t.x>a.left&&t.x<a.right&&t.y>a.top&&t.y<a.bottom){var l=Math.floor((t.x-a.left)/p.width)+1,c=Math.floor((t.y-a.top)/p.height)+1;1===r?(l=0,c=0):2===r&&(l=(l-1)*-1,c=-1),u.onMove({player:u.player,x:l,y:c})&&t.reset(),o=!0}}o||(null!==u.player.row&&null!==u.player.col?u.onRemove({player:u.player})&&t.reset():t.reset()),i(function(){f(!1),h=!1,e.$apply()},100),s.cancel(d.promise),d.promise=null}};o.bind(c,g,{}),r.bind(c,{start:function(e){h||(p=c.getBoundingClientRect(),f(!0))},cancel:function(e){h||f(!1)},end:function(e){h||f(!1)}},{})}]});